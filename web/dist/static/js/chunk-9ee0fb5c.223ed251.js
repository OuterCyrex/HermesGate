(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9ee0fb5c"],{"22ce":function(e,t,r){"use strict";r.d(t,"f",(function(){return a})),r.d(t,"d",(function(){return l})),r.d(t,"e",(function(){return o})),r.d(t,"g",(function(){return s})),r.d(t,"i",(function(){return n})),r.d(t,"b",(function(){return u})),r.d(t,"j",(function(){return c})),r.d(t,"c",(function(){return m})),r.d(t,"h",(function(){return d})),r.d(t,"a",(function(){return p}));var i=r("b775");function a(e){return Object(i["a"])({url:"/service/list",method:"get",params:e})}function l(e){return Object(i["a"])({url:"/service/delete/"+e.id,method:"delete"})}function o(e){return Object(i["a"])({url:"/service/detail/"+e.id,method:"get"})}function s(e){return Object(i["a"])({url:"/service/stat/"+e.id,method:"get"})}function n(e){return Object(i["a"])({url:"/service/update/http/"+e.id,method:"put",data:e})}function u(e){return Object(i["a"])({url:"/service/add/http",method:"post",data:e})}function c(e){return Object(i["a"])({url:"/service/update/tcp/"+e.id,method:"put",data:e})}function m(e){return Object(i["a"])({url:"/service/add/tcp",method:"post",data:e})}function d(e){return Object(i["a"])({url:"/service/update/grpc/"+e.id,method:"put",data:e})}function p(e){return Object(i["a"])({url:"/service/add/grpc",method:"post",data:e})}},"4aee":function(e,t,r){},7207:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"mixin-components-container"},[r("el-row",[r("el-card",{staticClass:"box-card"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[!1===e.isEdit?r("span",[e._v("创建HTTP服务")]):e._e(),!0===e.isEdit?r("span",[e._v("修改HTTP服务")]):e._e()]),r("div",{staticStyle:{"margin-bottom":"50px"}},[r("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"140px"}},[r("el-form-item",{staticClass:"is-required",attrs:{label:"服务名称",prop:"service_name"}},[r("el-input",{attrs:{placeholder:"6-128位字母数字下划线",disabled:!0===e.isEdit},model:{value:e.form.service_name,callback:function(t){e.$set(e.form,"service_name",t)},expression:"form.service_name"}})],1),r("el-form-item",{staticClass:"is-required",attrs:{label:"服务描述",prop:"service_desc"}},[r("el-input",{attrs:{placeholder:"最多255字符",disabled:!0===e.isEdit},model:{value:e.form.service_desc,callback:function(t){e.$set(e.form,"service_desc",t)},expression:"form.service_desc"}})],1),r("el-form-item",{staticClass:"is-required",attrs:{label:"接入类型",prop:"rule"}},[r("el-input",{staticClass:"input-with-select",attrs:{disabled:!0===e.isEdit,placeholder:"路径格式：/user/,域名格式：www.test.com"},model:{value:e.form.rule,callback:function(t){e.$set(e.form,"rule",t)},expression:"form.rule"}},[r("el-select",{staticStyle:{width:"80px"},attrs:{slot:"prepend",placeholder:"请选择",disabled:!0===e.isEdit},slot:"prepend",model:{value:e.form.rule_type,callback:function(t){e.$set(e.form,"rule_type",t)},expression:"form.rule_type"}},[r("el-option",{attrs:{label:"路径",value:0}}),r("el-option",{attrs:{label:"域名",value:1}})],1)],1)],1),r("el-form-item",{attrs:{label:"支持https"}},[r("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.need_https,callback:function(t){e.$set(e.form,"need_https",t)},expression:"form.need_https"}}),r("span",{staticStyle:{color:"#606266","font-weight":"700"}},[e._v(" 支持strip_uri ")]),r("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.need_strip_uri,callback:function(t){e.$set(e.form,"need_strip_uri",t)},expression:"form.need_strip_uri"}}),r("span",{staticStyle:{color:"#606266","font-weight":"700"}},[e._v(" 支持websocket ")]),r("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.need_websocket,callback:function(t){e.$set(e.form,"need_websocket",t)},expression:"form.need_websocket"}})],1),r("el-form-item",{attrs:{label:"URL重写",prop:"url_rewrite"}},[e._l(e.form.url_rewrite,(function(t,i){return r("div",{key:"url-"+i,staticClass:"input-group"},[r("el-input",{staticStyle:{width:"calc(40% - 50px)","margin-right":"10px"},attrs:{placeholder:"格式：^/gateway/test_service(.*) $1"},model:{value:e.form.url_rewrite[i],callback:function(t){e.$set(e.form.url_rewrite,i,t)},expression:"form.url_rewrite[index]"}}),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.removeItem("url_rewrite",i)}}},[e._v("删除")])],1)})),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addItem("url_rewrite")}}},[e._v("添加")])],2),r("el-form-item",{attrs:{label:"Header转换",prop:"header_transfer"}},[e._l(e.form.header_transfer,(function(t,i){return r("div",{key:"header-"+i,staticClass:"input-group"},[r("el-input",{staticStyle:{width:"calc(40% - 50px)","margin-right":"10px"},attrs:{placeholder:"格式：add headerName headValue"},model:{value:e.form.header_transfer[i],callback:function(t){e.$set(e.form.header_transfer,i,t)},expression:"form.header_transfer[index]"}}),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.removeItem("header_transfer",i)}}},[e._v("删除")])],1)})),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addItem("header_transfer")}}},[e._v("添加")])],2),r("el-form-item",{attrs:{label:"开启验证"}},[r("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:e.form.open_auth,callback:function(t){e.$set(e.form,"open_auth",t)},expression:"form.open_auth"}})],1),r("el-form-item",{attrs:{label:"IP白名单",prop:"white_list"}},[e._l(e.form.white_list,(function(t,i){return r("div",{key:"white-"+i,staticClass:"input-group"},[r("el-input",{staticStyle:{width:"calc(40% - 50px)","margin-right":"10px"},attrs:{placeholder:"127.0.0.1"},model:{value:e.form.white_list[i],callback:function(t){e.$set(e.form.white_list,i,t)},expression:"form.white_list[index]"}}),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.removeItem("white_list",i)}}},[e._v("删除")])],1)})),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addItem("white_list")}}},[e._v("添加")])],2),r("el-form-item",{attrs:{label:"IP黑名单",prop:"black_list"}},[e._l(e.form.black_list,(function(t,i){return r("div",{key:"black-"+i,staticClass:"input-group"},[r("el-input",{staticStyle:{width:"calc(40% - 50px)","margin-right":"10px"},attrs:{placeholder:"127.0.0.1"},model:{value:e.form.black_list[i],callback:function(t){e.$set(e.form.black_list,i,t)},expression:"form.black_list[index]"}}),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.removeItem("black_list",i)}}},[e._v("删除")])],1)})),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addItem("black_list")}}},[e._v("添加")])],2),r("el-form-item",{attrs:{label:"客户端限流",prop:"clientip_flow_limit"}},[r("el-input",{attrs:{placeholder:"0表示无限制"},model:{value:e.form.clientip_flow_limit,callback:function(t){e.$set(e.form,"clientip_flow_limit",t)},expression:"form.clientip_flow_limit"}})],1),r("el-form-item",{attrs:{label:"服务端限流",prop:"service_flow_limit"}},[r("el-input",{attrs:{placeholder:"0表示无限制"},model:{value:e.form.service_flow_limit,callback:function(t){e.$set(e.form,"service_flow_limit",t)},expression:"form.service_flow_limit"}})],1),r("el-form-item",{attrs:{label:"轮询方式",prop:"round_type"}},[r("el-radio-group",{model:{value:e.form.round_type,callback:function(t){e.$set(e.form,"round_type",t)},expression:"form.round_type"}},[r("el-radio",{attrs:{label:0}},[e._v("random")]),r("el-radio",{attrs:{label:1}},[e._v("round-robin")]),r("el-radio",{attrs:{label:2}},[e._v("weight_round-robin")]),r("el-radio",{attrs:{label:3}},[e._v("ip_hash")])],1)],1),r("el-form-item",{staticClass:"is-required",attrs:{label:"IP列表",prop:"ip_list"}},[e._l(e.form.ip_list,(function(t,i){return r("div",{key:"ip-"+i,staticClass:"input-group"},[r("el-input",{staticStyle:{width:"calc(40% - 50px)","margin-right":"10px"},attrs:{placeholder:"127.0.0.1:80"},model:{value:e.form.ip_list[i],callback:function(t){e.$set(e.form.ip_list,i,t)},expression:"form.ip_list[index]"}}),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.removeItem("ip_list",i)}}},[e._v("删除")])],1)})),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addItem("ip_list")}}},[e._v("添加")])],2),r("el-form-item",{staticClass:"is-required",attrs:{label:"权重列表",prop:"weight_list"}},[e._l(e.form.weight_list,(function(t,i){return r("div",{key:"weight-"+i,staticClass:"input-group"},[r("el-input",{staticStyle:{width:"calc(40% - 50px)","margin-right":"10px"},attrs:{placeholder:"50"},model:{value:e.form.weight_list[i],callback:function(t){e.$set(e.form.weight_list,i,t)},expression:"form.weight_list[index]"}}),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.removeItem("weight_list",i)}}},[e._v("删除")])],1)})),r("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addItem("weight_list")}}},[e._v("添加")])],2),r("el-form-item",{attrs:{label:"建立连接超时",prop:"upstream_connect_timeout"}},[r("el-input",{attrs:{placeholder:"单位s，0表示无限制"},model:{value:e.form.upstream_connect_timeout,callback:function(t){e.$set(e.form,"upstream_connect_timeout",t)},expression:"form.upstream_connect_timeout"}})],1),r("el-form-item",{attrs:{label:"获取header超时",prop:"upstream_header_timeout"}},[r("el-input",{attrs:{placeholder:"单位s，0表示无限制"},model:{value:e.form.upstream_header_timeout,callback:function(t){e.$set(e.form,"upstream_header_timeout",t)},expression:"form.upstream_header_timeout"}})],1),r("el-form-item",{attrs:{label:"链接最大空闲时间",prop:"upstream_idle_timeout"}},[r("el-input",{attrs:{placeholder:"单位s，0表示无限制"},model:{value:e.form.upstream_idle_timeout,callback:function(t){e.$set(e.form,"upstream_idle_timeout",t)},expression:"form.upstream_idle_timeout"}})],1),r("el-form-item",{attrs:{label:"最大空闲链接数",prop:"upstream_max_idle"}},[r("el-input",{attrs:{placeholder:"0表示无限制"},model:{value:e.form.upstream_max_idle,callback:function(t){e.$set(e.form,"upstream_max_idle",t)},expression:"form.upstream_max_idle"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",disabled:e.submitButDisabled},on:{click:e.handleSubmit}},[e._v("立即提交")])],1)],1)],1)])],1)],1)},a=[],l=(r("caad"),r("a15b"),r("a434"),r("a9e3"),r("d3b7"),r("ac1f"),r("00b4"),r("5319"),r("0643"),r("76d6"),r("22ce")),o={name:"ServiceCreateHttp",data:function(){return{isEdit:!1,submitButDisabled:!1,form:{service_name:"",service_desc:"",rule_type:0,rule:"",need_https:0,need_websocket:0,need_strip_uri:1,url_rewrite:[""],header_transfer:[""],round_type:2,ip_list:[""],weight_list:[""],upstream_connect_timeout:"",upstream_header_timeout:"",upstream_idle_timeout:"",upstream_max_idle:"",open_auth:0,black_list:[""],white_list:[""],clientip_flow_limit:"",service_flow_limit:""},rules:{service_name:[{required:!0,message:"请输入服务名称",trigger:"blur"},{min:6,max:128,message:"长度在 6 到 128 个字符之间",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"只能包含字母、数字和下划线",trigger:"blur"}],service_desc:[{required:!0,message:"请输入服务描述",trigger:"blur"},{max:255,message:"最多255个字符",trigger:"blur"}],rule:[{required:!0,message:"请输入接入类型",trigger:"blur"}],url_rewrite:[{validator:this.validateUrlRewrite,trigger:"blur"}],header_transfer:[{validator:this.validateHeaderTransfer,trigger:"blur"}],ip_list:[{validator:this.validateIpList,trigger:"blur"}],weight_list:[{validator:this.validateWeightList,trigger:"blur"}],white_list:[{validator:this.validateIpList,trigger:"blur"}],black_list:[{validator:this.validateIpList,trigger:"blur"}],clientip_flow_limit:[{validator:this.validateNonNegativeInteger,trigger:"blur"}],service_flow_limit:[{validator:this.validateNonNegativeInteger,trigger:"blur"}],upstream_connect_timeout:[{validator:this.validateNonNegativeInteger,trigger:"blur"}],upstream_header_timeout:[{validator:this.validateNonNegativeInteger,trigger:"blur"}],upstream_idle_timeout:[{validator:this.validateNonNegativeInteger,trigger:"blur"}],upstream_max_idle:[{validator:this.validateNonNegativeInteger,trigger:"blur"}]}}},created:function(){var e=this.$route.params&&this.$route.params.id;e>0&&(this.isEdit=!0,this.fetchData(e))},methods:{fetchData:function(e){var t=this,r={id:e};Object(l["e"])(r).then((function(e){var r=e.data;t.form.id=r.Info.ID,t.form.service_name=r.Info.ServiceName,t.form.service_desc=r.Info.ServiceDesc,t.form.rule_type=r.Http.RuleType,t.form.rule=r.Http.Rule,t.form.need_https=r.Http.NeedHttps,t.form.need_websocket=r.Http.NeedWebsocket,t.form.need_strip_uri=r.Http.NeedStripUri,t.form.url_rewrite=r.Http.UrlRewrite.replace(/,/g,"\n").split("\n"),t.form.header_transfer=r.Http.HeaderTransfer.replace(/,/g,"\n").split("\n"),t.form.round_type=r.LoadBalance.RoundType,t.form.ip_list=r.LoadBalance.IpList.replace(/,/g,"\n").split("\n"),t.form.weight_list=r.LoadBalance.WeightList.replace(/,/g,"\n").split("\n"),t.form.upstream_connect_timeout=r.LoadBalance.UpstreamConnectTimeout,t.form.upstream_header_timeout=r.LoadBalance.UpstreamHeaderTimeout,t.form.upstream_idle_timeout=r.LoadBalance.UpstreamIdleTimeout,t.form.upstream_max_idle=r.LoadBalance.UpstreamMaxIdle,t.form.open_auth=r.AccessControl.OpenAuth,t.form.black_list=r.AccessControl.BlackList.replace(/,/g,"\n").split("\n"),t.form.white_list=r.AccessControl.WhiteList.replace(/,/g,"\n").split("\n"),t.form.clientip_flow_limit=r.AccessControl.ClientIPFlowLimit,t.form.service_flow_limit=r.AccessControl.ServiceFlowLimit})).catch((function(e){console.log(e),t.$notify({message:"出错",type:"error",duration:2e3})}))},handleSubmit:function(){var e=this;this.$refs.form.validate((function(t){if(t){e.submitButDisabled=!0;var r=Object.assign({},e.form);if(r.ip_list&&r.weight_list&&r.ip_list.length!==r.weight_list.length)return e.submitButDisabled=!1,void e.$message.error("ip列表和权重列表应一一对应");r.url_rewrite=r.url_rewrite.join(","),r.header_transfer=r.header_transfer.join(","),r.ip_list=r.ip_list.join(","),r.weight_list=r.weight_list.join(","),r.black_list=r.black_list.join(","),r.white_list=r.white_list.join(","),r.service_flow_limit=Number(r.service_flow_limit),r.clientip_flow_limit=Number(r.clientip_flow_limit),r.upstream_connect_timeout=Number(r.upstream_connect_timeout),r.upstream_header_timeout=Number(r.upstream_header_timeout),r.upstream_idle_timeout=Number(r.upstream_idle_timeout),r.upstream_max_idle=Number(r.upstream_max_idle),e.isEdit?Object(l["i"])(r).then((function(){e.submitButDisabled=!1,e.$notify({title:"Success",message:"修改成功",type:"success",duration:2e3})})).catch((function(){e.submitButDisabled=!1})):Object(l["b"])(r).then((function(){e.submitButDisabled=!1,e.$notify({title:"Success",message:"添加成功",type:"success",duration:2e3})})).catch((function(){e.submitButDisabled=!1}))}else e.$message.error("请正确填写信息")}))},addItem:function(e){this.form[e].push("")},removeItem:function(e,t){this.form[e].splice(t,1)},validateHeaderTransfer:function(e,t,r){var i=t.every((function(e){var t=e.split(" ");return 3===t.length&&["add","del","edit"].includes(t[0].toLowerCase())}));i?r():r(new Error("Header转换格式错误，每行应为：add/del/edit headerName headValue"))},validateIpList:function(e,t,r){var i=t.every((function(e){return/^(\d{1,3}\.){3}\d{1,3}(:\d+)?$/.test(e)}));i?r():r(new Error("IP列表格式错误，每项应为有效的IP地址或IP:端口"))},validateWeightList:function(e,t,r){var i=t.every((function(e){return/^\d+$/.test(e)}));i?r():r(new Error("权重列表格式错误，每项应为非负整数"))},validateUrlRewrite:function(e,t,r){var i=/^\/[a-zA-Z0-9_.\-]+(\/[a-zA-Z0-9_.\-]+)*$/;if(t){var a=t.every((function(e){return i.test(e)}));a?r():r(new Error("URL重写格式错误，每行应为：/path/to/resource"))}else r(new Error("URL重写不能为空"))},validateNonNegativeInteger:function(e,t,r){t?/^\d+$/.test(t)?r():r(new Error("请输入非负整数")):r()}}},s=o,n=(r("b478"),r("2877")),u=Object(n["a"])(s,i,a,!1,null,"52038524",null);t["default"]=u.exports},"76d6":function(e,t,r){"use strict";var i=r("23e7"),a=r("2266"),l=r("1c0b"),o=r("825a");i({target:"Iterator",proto:!0,real:!0},{every:function(e){return o(this),l(e),!a(this,(function(t){if(!e(t))return a.stop()}),void 0,!1,!0).stopped}})},b478:function(e,t,r){"use strict";r("4aee")}}]);