(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6dd3e8df"],{"22ce":function(t,e,i){"use strict";i.d(e,"f",(function(){return a})),i.d(e,"d",(function(){return l})),i.d(e,"e",(function(){return o})),i.d(e,"g",(function(){return n})),i.d(e,"i",(function(){return s})),i.d(e,"b",(function(){return c})),i.d(e,"j",(function(){return u})),i.d(e,"c",(function(){return d})),i.d(e,"h",(function(){return f})),i.d(e,"a",(function(){return m}));var r=i("b775");function a(t){return Object(r["a"])({url:"/service/list",method:"get",params:t})}function l(t){return Object(r["a"])({url:"/service/delete/"+t.id,method:"delete"})}function o(t){return Object(r["a"])({url:"/service/detail/"+t.id,method:"get"})}function n(t){return Object(r["a"])({url:"/service/stat/"+t.id,method:"get"})}function s(t){return Object(r["a"])({url:"/service/update/http/"+t.id,method:"put",data:t})}function c(t){return Object(r["a"])({url:"/service/add/http",method:"post",data:t})}function u(t){return Object(r["a"])({url:"/service/update/tcp/"+t.id,method:"put",data:t})}function d(t){return Object(r["a"])({url:"/service/add/tcp",method:"post",data:t})}function f(t){return Object(r["a"])({url:"/service/update/grpc/"+t.id,method:"put",data:t})}function m(t){return Object(r["a"])({url:"/service/add/grpc",method:"post",data:t})}},"489f":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mixin-components-container"},[i("el-row",[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"130px"}},[i("el-card",{staticClass:"box-card",staticStyle:{"margin-bottom":"20px"}},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[!1===t.is_edit?i("span",[t._v("创建GRPC服务")]):t._e(),!0===t.is_edit?i("span",[t._v("修改GRPC服务")]):t._e()]),i("div",[i("el-form-item",{staticClass:"is-required",attrs:{label:"服务名称",prop:"service_name"}},[i("el-input",{attrs:{disabled:!0===t.is_edit,placeholder:"6-128位字母数字下划线"},model:{value:t.form.service_name,callback:function(e){t.$set(t.form,"service_name",e)},expression:"form.service_name"}})],1),i("el-form-item",{staticClass:"is-required",attrs:{label:"服务描述",prop:"service_desc"}},[i("el-input",{attrs:{placeholder:"最多255字符，必填"},model:{value:t.form.service_desc,callback:function(e){t.$set(t.form,"service_desc",e)},expression:"form.service_desc"}})],1),i("el-form-item",{staticClass:"is-required",attrs:{label:"端口",prop:"port"}},[i("el-input",{attrs:{disabled:!0===t.is_edit,placeholder:"需要设置8001-8999范围内数字，必填"},model:{value:t.form.port,callback:function(e){t.$set(t.form,"port",e)},expression:"form.port"}})],1),i("el-form-item",{attrs:{label:"metadata转换",prop:"header_transfer"}},[t._l(t.form.header_transfer,(function(e,r){return i("div",{key:"header-"+r,staticClass:"input-group"},[i("el-input",{staticStyle:{width:"calc(40% - 50px)"},attrs:{placeholder:"格式: add headname headvalue"},model:{value:t.form.header_transfer[r],callback:function(e){t.$set(t.form.header_transfer,r,e)},expression:"form.header_transfer[index]"}}),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:function(e){return t.removeItem("header_transfer",r)}}},[t._v("删除")])],1)})),i("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"text"},on:{click:function(e){return t.addItem("header_transfer")}}},[t._v("添加")])],2),i("el-form-item",{attrs:{label:"开启验证"}},[i("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.form.open_auth,callback:function(e){t.$set(t.form,"open_auth",e)},expression:"form.open_auth"}})],1),i("el-form-item",{attrs:{label:"IP白名单",prop:"white_list"}},[t._l(t.form.white_list,(function(e,r){return i("div",{key:"white-"+r,staticClass:"input-group"},[i("el-input",{staticStyle:{width:"calc(40% - 50px)"},attrs:{placeholder:"127.0.0.1"},model:{value:t.form.white_list[r],callback:function(e){t.$set(t.form.white_list,r,e)},expression:"form.white_list[index]"}}),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:function(e){return t.removeItem("white_list",r)}}},[t._v("删除")])],1)})),i("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"text"},on:{click:function(e){return t.addItem("white_list")}}},[t._v("添加")])],2),i("el-form-item",{attrs:{label:"IP黑名单",prop:"black_list"}},[t._l(t.form.black_list,(function(e,r){return i("div",{key:"black-"+r,staticClass:"input-group"},[i("el-input",{staticStyle:{width:"calc(40% - 50px)"},attrs:{placeholder:"127.0.0.1"},model:{value:t.form.black_list[r],callback:function(e){t.$set(t.form.black_list,r,e)},expression:"form.black_list[index]"}}),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:function(e){return t.removeItem("black_list",r)}}},[t._v("删除")])],1)})),i("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"text"},on:{click:function(e){return t.addItem("black_list")}}},[t._v("添加")])],2),i("el-form-item",{attrs:{label:"客户端限流",prop:"clientip_flow_limit"}},[i("el-input",{attrs:{placeholder:"0表示无限制"},model:{value:t.form.clientip_flow_limit,callback:function(e){t.$set(t.form,"clientip_flow_limit",e)},expression:"form.clientip_flow_limit"}})],1),i("el-form-item",{attrs:{label:"服务端限流",prop:"service_flow_limit"}},[i("el-input",{attrs:{placeholder:"0表示无限制"},model:{value:t.form.service_flow_limit,callback:function(e){t.$set(t.form,"service_flow_limit",e)},expression:"form.service_flow_limit"}})],1),i("el-form-item",{attrs:{label:"轮询方式",prop:"round_type"}},[i("el-radio",{attrs:{label:"0"},model:{value:t.form.round_type,callback:function(e){t.$set(t.form,"round_type",e)},expression:"form.round_type"}},[t._v("random")]),i("el-radio",{attrs:{label:"1"},model:{value:t.form.round_type,callback:function(e){t.$set(t.form,"round_type",e)},expression:"form.round_type"}},[t._v("round-robin")]),i("el-radio",{attrs:{label:"2"},model:{value:t.form.round_type,callback:function(e){t.$set(t.form,"round_type",e)},expression:"form.round_type"}},[t._v("weight_round-robin")]),i("el-radio",{attrs:{label:"3"},model:{value:t.form.round_type,callback:function(e){t.$set(t.form,"round_type",e)},expression:"form.round_type"}},[t._v("ip_hash")])],1),i("el-form-item",{staticClass:"is-required",attrs:{label:"IP列表",prop:"ip_list"}},[t._l(t.form.ip_list,(function(e,r){return i("div",{key:"ip-"+r,staticClass:"input-group"},[i("el-input",{staticStyle:{width:"calc(40% - 50px)"},attrs:{placeholder:"127.0.0.1:80"},model:{value:t.form.ip_list[r],callback:function(e){t.$set(t.form.ip_list,r,e)},expression:"form.ip_list[index]"}}),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:function(e){return t.removeItem("ip_list",r)}}},[t._v("删除")])],1)})),i("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"text"},on:{click:function(e){return t.addItem("ip_list")}}},[t._v("添加")])],2),i("el-form-item",{staticClass:"is-required",attrs:{label:"权重列表",prop:"weight_list"}},[t._l(t.form.weight_list,(function(e,r){return i("div",{key:"weight-"+r,staticClass:"input-group"},[i("el-input",{staticStyle:{width:"calc(40% - 50px)"},attrs:{placeholder:"50"},model:{value:t.form.weight_list[r],callback:function(e){t.$set(t.form.weight_list,r,e)},expression:"form.weight_list[index]"}}),i("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text"},on:{click:function(e){return t.removeItem("weight_list",r)}}},[t._v("删除")])],1)})),i("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"text"},on:{click:function(e){return t.addItem("weight_list")}}},[t._v("添加")])],2),i("el-form-item",[i("el-button",{attrs:{type:"primary",loading:t.disableButton},on:{click:t.onSubmit}},[t._v("立即提交")])],1)],1)])],1)],1)],1)},a=[],l=(i("4de4"),i("caad"),i("a15b"),i("a434"),i("a9e3"),i("d3b7"),i("ac1f"),i("00b4"),i("25f0"),i("0643"),i("76d6"),i("2382"),i("22ce")),o={components:{},data:function(){return{is_edit:!1,disableButton:!1,form:{id:"0",service_name:"",service_desc:"",port:"",open_auth:"0",clientip_flow_limit:"",service_flow_limit:"",round_type:"2",ip_list:[""],weight_list:[""],white_list:[""],black_list:[""],header_transfer:[""]},rules:{service_name:[{required:!0,message:"请输入服务名称",trigger:"blur"},{min:6,max:128,message:"长度在 6 到 128 个字符之间",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"只能包含字母、数字和下划线",trigger:"blur"}],service_desc:[{required:!0,message:"请输入服务描述",trigger:"blur"},{max:255,message:"最多255个字符",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"},{pattern:/^(8000|80[1-9][0-9]|8[1-9][0-9]{2})$/,message:"端口范围为8001-8999",trigger:"blur"}],ip_list:[{validator:this.validateIpList,trigger:"blur"}],weight_list:[{validator:this.validateWeightList,trigger:"blur"}],header_transfer:[{validator:this.validateHeaderTransfer,trigger:"blur"}],white_list:[{validator:this.validateIpList,trigger:"blur"}],black_list:[{validator:this.validateIpList,trigger:"blur"}],clientip_flow_limit:[{validator:this.validateNonNegativeInteger,trigger:"blur"}],service_flow_limit:[{validator:this.validateNonNegativeInteger,trigger:"blur"}]}}},created:function(){var t=this.$route.params&&this.$route.params.id;t>0&&(this.is_edit=!0,this.fetchData(t)),this.tempRoute=Object.assign({},this.$route)},methods:{fetchData:function(t){var e=this;this.listLoading=!0;var i={id:t};Object(l["e"])(i).then((function(t){var i=t.data;e.form.id=i.Info.ID,e.form.service_name=i.Info.ServiceName,e.form.service_desc=i.Info.ServiceDesc,e.form.port=i.Grpc.Port.toString(),e.form.open_auth=i.AccessControl.OpenAuth.toString(),e.form.clientip_flow_limit=i.AccessControl.ClientIPFlowLimit,e.form.service_flow_limit=i.AccessControl.ServiceFlowLimit,e.form.round_type=i.LoadBalance.RoundType.toString(),e.form.ip_list=i.LoadBalance.IpList.split(",").filter(Boolean),e.form.weight_list=i.LoadBalance.WeightList.split(",").filter(Boolean),e.form.white_list=i.AccessControl.WhiteList.split(",").filter(Boolean),e.form.black_list=i.AccessControl.BlackList.split(",").filter(Boolean),e.form.header_transfer=i.Grpc.HeaderTransfer.split(",").filter(Boolean),e.listLoading=!1}))},onSubmit:function(){var t=this;this.$refs.form.validate((function(e){if(e){t.disableButton=!0;var i=Object.assign({},t.form);if(i.ip_list&&i.weight_list&&i.ip_list.length!==i.weight_list.length)return t.disableButton=!1,void t.$message.error("ip列表与权重列表应一一对应");i.port=Number(i.port),i.open_auth=Number(i.open_auth),i.clientip_flow_limit=Number(i.clientip_flow_limit),i.service_flow_limit=Number(i.service_flow_limit),i.round_type=Number(i.round_type),i.ip_list=i.ip_list.join(","),i.weight_list=i.weight_list.join(","),i.white_list=i.white_list.join(","),i.black_list=i.black_list.join(","),i.header_transfer=i.header_transfer.join(","),t.is_edit?Object(l["h"])(i).then((function(){t.disableButton=!1,t.$notify({title:"Success",message:"更新成功",type:"success",duration:500})})).catch((function(){t.disableButton=!1})):Object(l["a"])(i).then((function(){t.disableButton=!1,t.$notify({title:"Success",message:"添加成功",type:"success",duration:500})})).catch((function(){t.disableButton=!1}))}else t.$message.error("请正确填写信息")}))},addItem:function(t){this.form[t].push("")},removeItem:function(t,e){this.form[t].splice(e,1)},validateIpList:function(t,e,i){var r=e.every((function(t){return/^(\d{1,3}\.){3}\d{1,3}(:\d+)?$/.test(t)}));r?i():i(new Error("IP列表格式错误，每项应为有效的IP地址或IP:端口"))},validateWeightList:function(t,e,i){var r=e.every((function(t){return/^\d+$/.test(t)}));r?i():i(new Error("权重列表格式错误，每项应为非负整数"))},validateHeaderTransfer:function(t,e,i){var r=e.every((function(t){var e=t.split(" ");return 3===e.length&&["add","del","edit"].includes(e[0].toLowerCase())}));r?i():i(new Error("metadata转换格式错误，每行应为：add/del/edit headname headvalue"))},validateNonNegativeInteger:function(t,e,i){e?/^\d+$/.test(e)?i():i(new Error("请输入非负整数")):i()}}},n=o,s=(i("5312"),i("2877")),c=Object(s["a"])(n,r,a,!1,null,"4f234a39",null);e["default"]=c.exports},5312:function(t,e,i){"use strict";i("5d17")},"5d17":function(t,e,i){},"76d6":function(t,e,i){"use strict";var r=i("23e7"),a=i("2266"),l=i("1c0b"),o=i("825a");r({target:"Iterator",proto:!0,real:!0},{every:function(t){return o(this),l(t),!a(this,(function(e){if(!t(e))return a.stop()}),void 0,!1,!0).stopped}})}}]);